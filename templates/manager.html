{% extends "base.html" %}
{% block content %}

<div class="w-full min-h-screen bg-gradient-to-br from-gray-900 via-black to-purple-900 text-white px-4 py-8">
    <div class="max-w-6xl mx-auto">

        <!-- Heading -->
        <h1 class="text-3xl font-bold mb-6">Manager Dashboard</h1>

        <!-- Filters and Search -->
        <div class="flex flex-col md:flex-row md:justify-between gap-4 mb-6">
            <input type="text" id="searchInput" placeholder="Search by employee or description"
                class="p-2 rounded-md border border-zinc-700 bg-[#141414] focus:ring-2 focus:ring-violet-500 outline-none text-sm w-full md:w-1/2">
            <select id="filterStatus"
                class="p-2 rounded-md border border-zinc-700 bg-[#141414] focus:ring-2 focus:ring-violet-500 outline-none text-sm w-full md:w-1/4">
                <option value="">All Status</option>
                <option value="approved">Approved</option>
                <option value="pending">Pending</option>
                <option value="rejected">Rejected</option>
                <option value="escalated">Escalated</option>
            </select>
        </div>

        <!-- Team Expenses Table -->
        <div class="bg-[#181818] shadow-2xl rounded-xl p-4 overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="border-b border-zinc-700">
                        <th class="p-2">ID</th>
                        <th class="p-2">Employee</th>
                        <th class="p-2">Description</th>
                        <th class="p-2">Amount (₹)</th>
                        <th class="p-2">Date</th>
                        <th class="p-2">Status</th>
                        <th class="p-2">Actions</th>
                    </tr>
                </thead>
                <tbody id="expenseTableBody">
                    {% set dummy_expenses = [
                    {'id': 1, 'employee':'John Doe', 'description':'Travel to client site', 'amount':1500,
                    'date':'2025-10-01', 'status':'pending'},
                    {'id': 2, 'employee':'Jane Smith', 'description':'Team lunch', 'amount':1200, 'date':'2025-10-02',
                    'status':'approved'},
                    {'id': 3, 'employee':'Mike Lee', 'description':'Stationery purchase', 'amount':500,
                    'date':'2025-10-03', 'status':'pending'},
                    {'id': 4, 'employee':'Alice Brown', 'description':'Conference registration', 'amount':3000,
                    'date':'2025-10-04', 'status':'escalated'}
                    ] %}
                    {% for expense in dummy_expenses %}
                    <tr class="border-b border-zinc-700">
                        <td class="p-2">{{ expense.id }}</td>
                        <td class="p-2">{{ expense.employee }}</td>
                        <td class="p-2">{{ expense.description }}</td>
                        <td class="p-2">₹{{ expense.amount }}</td>
                        <td class="p-2">{{ expense.date }}</td>
                        <td class="p-2">
                            {% if expense.status == 'approved' %}
                            <span class="text-green-400 font-semibold">{{ expense.status|capitalize }}</span>
                            {% elif expense.status == 'pending' %}
                            <span class="text-yellow-400 font-semibold">{{ expense.status|capitalize }}</span>
                            {% elif expense.status == 'rejected' %}
                            <span class="text-red-500 font-semibold">{{ expense.status|capitalize }}</span>
                            {% elif expense.status == 'escalated' %}
                            <span class="text-purple-400 font-semibold">{{ expense.status|capitalize }}</span>
                            {% else %}
                            {{ expense.status }}
                            {% endif %}
                        </td>
                        <td class="p-2 flex gap-2">
                            {% if expense.status == 'pending' %}
                            <form method="post" action="/manager/expenses/{{ expense.id }}/approve">
                                <button type="submit"
                                    class="bg-green-500 hover:bg-green-600 px-3 py-1 rounded-md text-sm">Approve</button>
                            </form>
                            <form method="post" action="/manager/expenses/{{ expense.id }}/reject">
                                <button type="submit"
                                    class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded-md text-sm">Reject</button>
                            </form>
                            <form method="post" action="/manager/expenses/{{ expense.id }}/escalate">
                                <button type="submit"
                                    class="bg-purple-500 hover:bg-purple-600 px-3 py-1 rounded-md text-sm">Escalate</button>
                            </form>
                            {% else %}
                            <span class="text-gray-400">No actions</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const searchInput = document.getElementById('searchInput');
    const filterStatus = document.getElementById('filterStatus');
    const tableBody = document.getElementById('expenseTableBody');

    function filterExpenses() {
        const searchValue = searchInput.value.toLowerCase();
        const statusValue = filterStatus.value.toLowerCase();

        for (let row of tableBody.rows) {
            const employee = row.cells[1].textContent.toLowerCase();
            const description = row.cells[2].textContent.toLowerCase();
            const status = row.cells[5].textContent.toLowerCase();

            const matchesSearch = employee.includes(searchValue) || description.includes(searchValue);
            const matchesStatus = !statusValue || status === statusValue;

            row.style.display = matchesSearch && matchesStatus ? '' : 'none';
        }
    }

    searchInput.addEventListener('input', filterExpenses);
    filterStatus.addEventListener('change', filterExpenses);
</script>

{% endblock %}